<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>æˆ‘çš„åœ°ç›˜æˆ‘åšä¸»</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
            background: linear-gradient(135deg, #6e8efb, #a777e3);
            min-height: 100vh;
            padding: 20px;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            min-height: calc(100vh - 40px);
            position: relative;
            border: 15px solid #ff9a9e;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        /* é¡µé¢é€šç”¨æ ·å¼ */
        .page {
            display: none;
            min-height: 700px;
        }

        .page.active {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            border-radius: 25px;
            border: 8px solid #ff6b8b;
            box-shadow: 0 10px 30px rgba(255, 107, 139, 0.4);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: sparkle 3s linear infinite;
        }

        @keyframes sparkle {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        h1 {
            font-size: 3.5em;
            color: #fff;
            text-shadow: 4px 4px 0 #ff6b8b,
                       6px 6px 0 rgba(0,0,0,0.1);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        h2 {
            font-size: 2.8em;
            color: #ff6b8b;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        h3 {
            font-size: 2.2em;
            color: #a777e3;
            margin-bottom: 20px;
            text-align: center;
        }

        /* æŒ‰é’®æ ·å¼ */
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-top: 60px;
        }

        .btn {
            padding: 28px 40px;
            font-size: 1.8em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-weight: bold;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            z-index: 1;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(-4px) scale(1.02);
        }

        .btn-main {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: white;
            border: 6px solid #ff6b8b;
        }

        .btn-correct {
            background: linear-gradient(45deg, #56ab2f, #a8e063);
            color: white;
            border: 6px solid #2e8b57;
            font-size: 1.6em;
            flex: 1;
        }

        .btn-wrong {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            border: 6px solid #dc143c;
            font-size: 1.6em;
            flex: 1;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #4776E6, #8E54E9);
            color: white;
            border: 6px solid #5d4ae3;
        }

        .btn-return {
            background: linear-gradient(45deg, #36D1DC, #5B86E5);
            color: white;
            border: 6px solid #1e90ff;
            font-size: 1.5em;
            padding: 20px 30px;
        }

        /* é¢˜ç›®æ˜¾ç¤ºåŒºåŸŸ */
        .question-area {
            background: linear-gradient(135deg, #fdfcfb, #e2d1c3);
            padding: 30px;
            border-radius: 25px;
            border: 6px solid #d4a574;
            margin-bottom: 30px;
            min-height: 200px;
        }

        .question-info {
            font-size: 1.6em;
            color: #8b4513;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px dashed #d4a574;
        }

        .question-content {
            font-size: 1.8em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 20px;
        }

        .answer-area {
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            padding: 30px;
            border-radius: 25px;
            border: 6px solid #26c6da;
            margin-bottom: 30px;
            min-height: 150px;
            display: none;
        }

        .answer-content {
            font-size: 1.8em;
            line-height: 1.6;
            color: #006064;
        }

        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .control-buttons {
            display: flex;
            gap: 20px;
            margin: 40px 0;
        }

        .control-buttons .btn {
            flex: 1;
            padding: 25px 20px;
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 4px dashed #ccc;
        }

        /* ç»Ÿè®¡è¡¨æ ¼ */
        .stats-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 30px 0;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .stats-table th {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            color: white;
            padding: 25px;
            font-size: 1.8em;
            text-align: center;
            border-right: 2px solid #ff6b8b;
        }

        .stats-table th:last-child {
            border-right: none;
        }

        .stats-table td {
            padding: 25px;
            font-size: 1.6em;
            text-align: center;
            border-right: 2px solid #eee;
            border-bottom: 2px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stats-table td:last-child {
            border-right: none;
        }

        .stats-table tr:last-child td {
            border-bottom: none;
        }

        .stats-table td:hover {
            background-color: #f0f8ff;
            transform: scale(1.05);
        }

        .stats-table .subject-row {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            font-weight: bold;
        }

        /* é”™é¢˜åˆ—è¡¨ */
        .wrong-questions-list {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-height: 600px;
            overflow-y: auto;
            border: 6px solid #ff9a9e;
            margin: 30px 0;
        }

        .wrong-question-item {
            background: linear-gradient(135deg, #fff5f5, #ffeaea);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 15px;
            border-left: 10px solid #ff6b8b;
            font-size: 1.6em;
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .wrong-question-item:hover {
            transform: translateX(10px);
            box-shadow: 0 10px 25px rgba(255, 107, 139, 0.3);
        }

        .wrong-question-item .number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: #ff6b8b;
            color: white;
            text-align: center;
            line-height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            font-weight: bold;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loader {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 10px solid #f3f3f3;
            border-top: 10px solid #ff6b8b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                border-width: 10px;
            }
            
            h1 {
                font-size: 2.5em;
            }
            
            h2 {
                font-size: 2em;
            }
            
            .btn {
                padding: 20px;
                font-size: 1.5em;
            }
            
            .question-content,
            .answer-content {
                font-size: 1.5em;
            }
            
            .stats-table th,
            .stats-table td {
                padding: 15px;
                font-size: 1.4em;
            }
        }

        /* å¯çˆ±å…ƒç´ è£…é¥° */
        .decoration {
            position: absolute;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            width: 20px;
            height: 20px;
            background: #ffeb3b;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .heart {
            width: 20px;
            height: 20px;
            background: #ff6b8b;
            transform: rotate(45deg);
            animation: heartbeat 1.5s infinite;
        }

        .heart:before,
        .heart:after {
            content: '';
            width: 20px;
            height: 20px;
            background: #ff6b8b;
            border-radius: 50%;
            position: absolute;
        }

        .heart:before {
            top: -10px;
            left: 0;
        }

        .heart:after {
            top: 0;
            left: -10px;
        }

        @keyframes heartbeat {
            0%, 100% { transform: rotate(45deg) scale(1); }
            50% { transform: rotate(45deg) scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- è£…é¥°å…ƒç´  -->
        <div class="decoration star" style="top: 50px; left: 50px;"></div>
        <div class="decoration heart" style="top: 100px; right: 100px;"></div>
        <div class="decoration star" style="bottom: 100px; left: 100px;"></div>
        <div class="decoration heart" style="bottom: 150px; right: 150px;"></div>
        
        <!-- é¡µé¢1: ä¸»é¡µé¢ -->
        <div id="page1" class="page active">
            <div class="header">
                <h1>é—¯å…³å¤§ä½œæˆ˜</h1>
            </div>
            <div class="buttons">
                <button class="btn btn-main" onclick="showPage(3)">
                    ğŸ“Š é”™é¢˜åˆ†æ
                </button>
                <button class="btn btn-secondary" onclick="showPage(2)">
                    ğŸ¯ å†’é™©å»å§
                </button>
                <button class="btn btn-secondary" onclick="exitApp()">
                    ğŸšª é€€å‡º
                </button>
            </div>
        </div>

        <!-- é¡µé¢2: æŒ‘æˆ˜é¡µé¢ -->
        <div id="page2" class="page">
            <div class="header">
                <h2>è¯·æŒ‘æˆ˜</h2>
            </div>
            
            <button class="btn btn-main" onclick="showRandomQuestion()" style="width: 100%; margin-bottom: 30px;">
                ğŸ” ç‚¹å‡»æ˜¾ç¤ºé¢˜ç›®
            </button>
            
            <div class="question-area">
                <div class="question-info" id="questionInfo">ç­‰å¾…é¢˜ç›®...</div>
                <div class="question-content" id="questionContent">è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è·å–é¢˜ç›®</div>
            </div>
            
            <button class="btn btn-secondary" onclick="showAnswer()" style="width: 100%; margin-bottom: 30px;">
                ğŸ¯ æ˜¾ç¤ºç­”æ¡ˆ
            </button>
            
            <div class="answer-area" id="answerArea">
                <div class="answer-content" id="answerContent">ç­”æ¡ˆå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</div>
            </div>
            
            <div class="control-buttons">
                <button class="btn btn-correct" onclick="recordAnswer(true)">
                    âœ… å¯¹å•¦ï¼
                </button>
                <button class="btn btn-wrong" onclick="recordAnswer(false)">
                    âŒ é”™äº†
                </button>
            </div>
            
            <div class="bottom-nav">
                <button class="btn btn-return" onclick="showPage(1)">
                    â†©ï¸ è¿”å›
                </button>
                <button class="btn btn-main" onclick="nextQuestion()">
                    ğŸ”„ ä¸‹ä¸€é¢˜
                </button>
            </div>
        </div>

        <!-- é¡µé¢3: é”™é¢˜ç»Ÿè®¡ -->
        <div id="page3" class="page">
            <div class="header">
                <h2>é”™é¢˜ç‡ç»Ÿè®¡</h2>
            </div>
            
            <div id="statsTableContainer">
                <!-- ç»Ÿè®¡è¡¨æ ¼å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="bottom-nav">
                <button class="btn btn-return" onclick="showPage(1)">
                    â†©ï¸ è¿”å›ä¸»é¡µ
                </button>
            </div>
        </div>

        <!-- é¡µé¢4: é”™é¢˜ç›®å½• -->
        <div id="page4" class="page">
            <div class="header">
                <h2>é”™é¢˜ç›®å½•</h2>
                <div id="unitTitle" style="font-size: 1.8em; color: white; margin-top: 10px;"></div>
            </div>
            
            <div class="wrong-questions-list" id="wrongQuestionsList">
                <!-- é”™é¢˜åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="bottom-nav">
                <button class="btn btn-return" onclick="showPage(3)">
                    â†©ï¸ è¿”å›ç»Ÿè®¡
                </button>
            </div>
        </div>

        <!-- åŠ è½½åŠ¨ç”» -->
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <div style="font-size: 1.5em; color: #666;">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script>
        // æ•°æ®åº“æ•°æ®
        let allQuestions = [];
        let currentQuestion = null;
        let wrongQuestions = {};
        let currentUnit = '';

        // åˆå§‹åŒ–å‡½æ•°
        function initApp() {
            loadData();
            loadWrongQuestions();
            updateStatsTable();
            
            // æ·»åŠ è£…é¥°å…ƒç´ 
            addDecorations();
        }

        // åŠ è½½é¢˜ç›®æ•°æ®
        async function loadData() {
            showLoader(true);
            try {
                // ä»localStorageåŠ è½½æ•°æ®
                const savedData = localStorage.getItem('questionData');
                if (savedData) {
                    allQuestions = JSON.parse(savedData);
                    console.log('ä»ç¼“å­˜åŠ è½½äº†', allQuestions.length, 'é“é¢˜ç›®');
                } else {
                    // ä½¿ç”¨ç¡¬ç¼–ç çš„æ•°æ®
                    await loadHardcodedData();
                    console.log('åŠ è½½äº†ç¡¬ç¼–ç æ•°æ®', allQuestions.length, 'é“é¢˜ç›®');
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                await loadHardcodedData();
            }
            showLoader(false);
        }

        // åŠ è½½ç¡¬ç¼–ç æ•°æ®ï¼ˆç¤ºä¾‹æ•°æ®ï¼‰
        async function loadHardcodedData() {
            // è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…åº”è¯¥åŒ…å«å®Œæ•´çš„Excelæ•°æ®
            // ä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬åˆ›å»ºä¸€äº›ç¤ºä¾‹æ•°æ®
            allQuestions = [
                {
                    "å­¦ç§‘": "è¯­æ–‡",
                    "å•å…ƒ": "ç¬¬1å•å…ƒ",
                    "è¯¾æ•°": "ç¬¬1è¯¾",
                    "è¯¾å": "ç™½é¹­",
                    "çŸ¥è¯†ç‚¹": "å­—éŸ³",
                    "é¢˜ç›®": "å®œ",
                    "ç­”æ¡ˆ": "å®œyÄ«ï¼ˆç›¸å®œã€é€‚å®œã€äº‹ä¸å®œè¿Ÿï¼‰"
                },
                {
                    "å­¦ç§‘": "è¯­æ–‡",
                    "å•å…ƒ": "ç¬¬1å•å…ƒ",
                    "è¯¾æ•°": "ç¬¬1è¯¾",
                    "è¯¾å": "ç™½é¹­",
                    "çŸ¥è¯†ç‚¹": "å­—éŸ³",
                    "é¢˜ç›®": "é¹¤",
                    "ç­”æ¡ˆ": "é¹¤hÃ©ï¼ˆç™½é¹­ã€ä¸¹é¡¶é¹¤ã€é¹¤å‘ç«¥é¢œï¼‰"
                },
                {
                    "å­¦ç§‘": "æ•°å­¦",
                    "å•å…ƒ": "ç¬¬1å•å…ƒ",
                    "è¯¾æ•°": "",
                    "è¯¾å": "å°æ•°ä¹˜æ³•",
                    "çŸ¥è¯†ç‚¹": "å°æ•°ä¹˜å°æ•°",
                    "é¢˜ç›®": "1.5Ã—0.8ï¼ˆæ•´æ•°éƒ¨åˆ†æ˜¯0ï¼‰å°±æ˜¯æ±‚",
                    "ç­”æ¡ˆ": "1.5Ã—0.8ï¼ˆæ•´æ•°éƒ¨åˆ†æ˜¯0ï¼‰å°±æ˜¯æ±‚ï¼š1.5çš„ååˆ†ä¹‹å…«æ˜¯å¤šå°‘ã€‚"
                },
                {
                    "å­¦ç§‘": "æ•°å­¦",
                    "å•å…ƒ": "ç¬¬1å•å…ƒ",
                    "è¯¾æ•°": "",
                    "è¯¾å": "å°æ•°ä¹˜æ³•",
                    "çŸ¥è¯†ç‚¹": "å°æ•°ä¹˜å°æ•°",
                    "é¢˜ç›®": "å°æ•°ä¹˜æ•´æ•°è®¡ç®—æ–¹æ³•æ˜¯å…ˆæŠŠå°æ•°æ‰©å¤§æˆæ•´æ•°",
                    "ç­”æ¡ˆ": "å°æ•°ä¹˜æ•´æ•°è®¡ç®—æ–¹æ³•æ˜¯å…ˆæŠŠå°æ•°æ‰©å¤§æˆæ•´æ•°ï¼šæŒ‰æ•´æ•°ä¹˜æ³•çš„æ³•åˆ™ç®—å‡ºç§¯ï¼›å†çœ‹å› æ•°ä¸­ä¸€å…±æœ‰å‡ ä½å°æ•°ï¼Œå°±ä»ç§¯çš„å³è¾¹èµ·æ•°å‡ºå‡ ä½ç‚¹ä¸Šå°æ•°ç‚¹ã€‚"
                },
                {
                    "å­¦ç§‘": "è‹±è¯­",
                    "å•å…ƒ": "Unit 1",
                    "è¯¾æ•°": "",
                    "è¯¾å": "å•è¯",
                    "çŸ¥è¯†ç‚¹": "å•è¯ï¼ˆå®¶åº­æˆå‘˜ç›¸å…³ï¼‰",
                    "é¢˜ç›®": "cousin",
                    "ç­”æ¡ˆ": "cousinå ‚ [è¡¨] å…„å¼Ÿï¼›å ‚ [è¡¨] å§å¦¹"
                }
            ];
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('questionData', JSON.stringify(allQuestions));
        }

        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }

        // æ˜¾ç¤ºéšæœºé¢˜ç›®
        function showRandomQuestion() {
            if (allQuestions.length === 0) {
                alert('é¢˜ç›®æ•°æ®åŠ è½½ä¸­ï¼Œè¯·ç¨å...');
                return;
            }
            
            const randomIndex = Math.floor(Math.random() * allQuestions.length);
            currentQuestion = allQuestions[randomIndex];
            
            // æ˜¾ç¤ºé¢˜ç›®ä¿¡æ¯
            const questionInfo = document.getElementById('questionInfo');
            const questionContent = document.getElementById('questionContent');
            
            questionInfo.innerHTML = `
                ${currentQuestion.å­¦ç§‘} - ${currentQuestion.å•å…ƒ} - ${currentQuestion.è¯¾å} - ${currentQuestion.çŸ¥è¯†ç‚¹}
            `;
            
            questionContent.textContent = `é¢˜ç›®ï¼š${currentQuestion.é¢˜ç›®}`;
            
            // éšè—ç­”æ¡ˆåŒºåŸŸ
            document.getElementById('answerArea').style.display = 'none';
        }

        // æ˜¾ç¤ºç­”æ¡ˆ
        function showAnswer() {
            if (!currentQuestion) {
                alert('è¯·å…ˆè·å–é¢˜ç›®ï¼');
                return;
            }
            
            const answerArea = document.getElementById('answerArea');
            const answerContent = document.getElementById('answerContent');
            
            answerContent.textContent = `ç­”æ¡ˆï¼š${currentQuestion.ç­”æ¡ˆ}`;
            answerArea.style.display = 'block';
        }

        // è®°å½•ç­”æ¡ˆå¯¹é”™
        function recordAnswer(isCorrect) {
            if (!currentQuestion) {
                alert('è¯·å…ˆè·å–é¢˜ç›®ï¼');
                return;
            }
            
            const questionKey = getQuestionKey(currentQuestion);
            
            if (!isCorrect) {
                // è®°å½•é”™é¢˜
                if (!wrongQuestions[currentQuestion.å­¦ç§‘]) {
                    wrongQuestions[currentQuestion.å­¦ç§‘] = {};
                }
                if (!wrongQuestions[currentQuestion.å­¦ç§‘][currentQuestion.å•å…ƒ]) {
                    wrongQuestions[currentQuestion.å­¦ç§‘][currentQuestion.å•å…ƒ] = [];
                }
                
                // æ£€æŸ¥æ˜¯å¦å·²ç»è®°å½•è¿‡
                const existingIndex = wrongQuestions[currentQuestion.å­¦ç§‘][currentQuestion.å•å…ƒ]
                    .findIndex(q => getQuestionKey(q) === questionKey);
                
                if (existingIndex === -1) {
                    wrongQuestions[currentQuestion.å­¦ç§‘][currentQuestion.å•å…ƒ].push({
                        ...currentQuestion,
                        timestamp: Date.now()
                    });
                    saveWrongQuestions();
                }
            } else {
                // å¦‚æœç­”å¯¹äº†ï¼Œä»é”™é¢˜ä¸­ç§»é™¤
                removeWrongQuestion(currentQuestion);
            }
            
            // æ˜¾ç¤ºåé¦ˆ
            if (isCorrect) {
                alert('ğŸ‰ å¤ªæ£’äº†ï¼ç­”å¯¹äº†ï¼');
            } else {
                alert('ğŸ’ª ç»§ç»­åŠ æ²¹ï¼è¿™é“é¢˜å·²åŠ å…¥é”™é¢˜æœ¬');
            }
        }

        // ç§»é™¤é”™é¢˜
        function removeWrongQuestion(question) {
            const questionKey = getQuestionKey(question);
            
            if (wrongQuestions[question.å­¦ç§‘] && wrongQuestions[question.å­¦ç§‘][question.å•å…ƒ]) {
                const index = wrongQuestions[question.å­¦ç§‘][question.å•å…ƒ]
                    .findIndex(q => getQuestionKey(q) === questionKey);
                
                if (index !== -1) {
                    wrongQuestions[question.å­¦ç§‘][question.unit].splice(index, 1);
                    saveWrongQuestions();
                }
            }
        }

        // è·å–é¢˜ç›®å”¯ä¸€æ ‡è¯†
        function getQuestionKey(question) {
            return `${question.å­¦ç§‘}_${question.å•å…ƒ}_${question.é¢˜ç›®}`;
        }

        // ä¿å­˜é”™é¢˜æ•°æ®
        function saveWrongQuestions() {
            localStorage.setItem('wrongQuestions', JSON.stringify(wrongQuestions));
            updateStatsTable();
        }

        // åŠ è½½é”™é¢˜æ•°æ®
        function loadWrongQuestions() {
            const saved = localStorage.getItem('wrongQuestions');
            if (saved) {
                wrongQuestions = JSON.parse(saved);
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            showRandomQuestion();
        }

        // æ˜¾ç¤ºé¡µé¢
        function showPage(pageNumber) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(`page${pageNumber}`).classList.add('active');
            
            // æ›´æ–°ç»Ÿè®¡è¡¨æ ¼ï¼ˆå¦‚æœæ˜¾ç¤ºé¡µé¢3ï¼‰
            if (pageNumber === 3) {
                updateStatsTable();
            }
        }

        // æ›´æ–°ç»Ÿè®¡è¡¨æ ¼
        function updateStatsTable() {
            const container = document.getElementById('statsTableContainer');
            if (!container) return;
            
            // ç»Ÿè®¡å„å­¦ç§‘å„å•å…ƒçš„é”™é¢˜ç‡
            const stats = calculateStats();
            
            let html = '<table class="stats-table">';
            
            // è¡¨å¤´
            html += '<thead><tr>';
            html += '<th>ç§‘ç›®</th>';
            html += '<th>å•å…ƒ1</th><th>å•å…ƒ2</th><th>å•å…ƒ3</th>';
            html += '<th>å•å…ƒ4</th><th>å•å…ƒ5</th><th>å•å…ƒ6</th>';
            html += '<th>å•å…ƒ7</th><th>å•å…ƒ8</th><th>å•å…ƒ9</th>';
            html += '</tr></thead>';
            
            // è¡¨æ ¼å†…å®¹
            html += '<tbody>';
            
            const subjects = ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­'];
            subjects.forEach(subject => {
                html += `<tr class="subject-row">`;
                html += `<td>${subject}</td>`;
                
                for (let i = 1; i <= 9; i++) {
                    const unit = `ç¬¬${i}å•å…ƒ`;
                    const stat = stats[subject]?.[unit] || null;
                    
                    if (stat && stat.total > 0) {
                        const errorRate = Math.round((stat.wrong / stat.total) * 100);
                        html += `<td onclick="showWrongQuestions('${subject}', '${unit}')" 
                                 style="color: ${errorRate > 50 ? '#ff416c' : errorRate > 20 ? '#ff9a00' : '#56ab2f'};
                                        font-weight: bold;">
                                ${errorRate}%
                                </td>`;
                    } else {
                        html += '<td>-</td>';
                    }
                }
                
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            
            container.innerHTML = html;
        }

        // è®¡ç®—ç»Ÿè®¡
        function calculateStats() {
            const stats = {};
            
            // åˆå§‹åŒ–ç»Ÿè®¡ç»“æ„
            ['è¯­æ–‡', 'æ•°å­¦', 'è‹±è¯­'].forEach(subject => {
                stats[subject] = {};
                for (let i = 1; i <= 9; i++) {
                    const unit = `ç¬¬${i}å•å…ƒ`;
                    stats[subject][unit] = { total: 0, wrong: 0 };
                }
            });
            
            // ç»Ÿè®¡æ€»é¢˜æ•°
            allQuestions.forEach(question => {
                if (stats[question.å­¦ç§‘] && stats[question.å­¦ç§‘][question.å•å…ƒ]) {
                    stats[question.å­¦ç§‘][question.å•å…ƒ].total++;
                }
            });
            
            // ç»Ÿè®¡é”™é¢˜æ•°
            Object.keys(wrongQuestions).forEach(subject => {
                Object.keys(wrongQuestions[subject] || {}).forEach(unit => {
                    if (stats[subject] && stats[subject][unit]) {
                        stats[subject][unit].wrong = wrongQuestions[subject][unit].length;
                    }
                });
            });
            
            return stats;
        }

        // æ˜¾ç¤ºé”™é¢˜åˆ—è¡¨
        function showWrongQuestions(subject, unit) {
            currentUnit = `${subject}_${unit}`;
            
            // è®¾ç½®å•å…ƒæ ‡é¢˜
            document.getElementById('unitTitle').textContent = `${subject} - ${unit}`;
            
            // æ˜¾ç¤ºé¡µé¢4
            showPage(4);
            
            // ç”Ÿæˆé”™é¢˜åˆ—è¡¨
            updateWrongQuestionsList();
        }

        // æ›´æ–°é”™é¢˜åˆ—è¡¨
        function updateWrongQuestionsList() {
            const [subject, unit] = currentUnit.split('_');
            const listContainer = document.getElementById('wrongQuestionsList');
            
            if (!wrongQuestions[subject] || !wrongQuestions[subject][unit]) {
                listContainer.innerHTML = '<div class="wrong-question-item">æš‚æ— é”™é¢˜ ğŸ‰</div>';
                return;
            }
            
            const questions = wrongQuestions[subject][unit];
            let html = '';
            
            questions.forEach((question, index) => {
                html += `
                    <div class="wrong-question-item">
                        <span class="number">${index + 1}</span>
                        <strong>${question.é¢˜ç›®}</strong><br>
                        <span style="color: #666; margin-left: 55px;">ç­”æ¡ˆï¼š${question.ç­”æ¡ˆ}</span>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        // é€€å‡ºåº”ç”¨
        function exitApp() {
            if (confirm('ç¡®å®šè¦é€€å‡ºå—ï¼Ÿ')) {
                // åœ¨PWAä¸­ï¼Œæˆ‘ä»¬åªèƒ½æ˜¾ç¤ºé€€å‡ºæç¤º
                alert('è¯·ä»ä¸»å±å¹•ç§»é™¤åº”ç”¨æˆ–å…³é—­æµè§ˆå™¨æ ‡ç­¾é¡µ');
            }
        }

        // æ·»åŠ è£…é¥°å…ƒç´ 
        function addDecorations() {
            const container = document.querySelector('.container');
            const decorations = ['star', 'heart', 'star', 'heart', 'star'];
            
            decorations.forEach((type, index) => {
                const deco = document.createElement('div');
                deco.className = `decoration ${type}`;
                deco.style.top = `${Math.random() * 80 + 10}%`;
                deco.style.left = `${Math.random() * 80 + 10}%`;
                deco.style.animationDelay = `${index * 0.5}s`;
                container.appendChild(deco);
            });
        }

        // PWAæœåŠ¡æ³¨å†Œ
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(error => {
                    console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                });
            });
        }

        // åº”ç”¨å¯åŠ¨
        window.addEventListener('DOMContentLoaded', initApp);

        // æ·»åŠ åˆ°ä¸»å±å¹•æç¤º
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // æ˜¾ç¤ºå®‰è£…æç¤º
            setTimeout(() => {
                if (confirm('æ˜¯å¦è¦å°†æ­¤åº”ç”¨æ·»åŠ åˆ°ä¸»å±å¹•ï¼Ÿ')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…æç¤º');
                        }
                        deferredPrompt = null;
                    });
                }
            }, 3000);
        });
    </script>
</body>
</html>